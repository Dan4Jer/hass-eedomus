### üéØ Tableau de Correspondance Eedomus ‚Üí Home Assistant

```mermaid
flowchart TD
    subgraph Legend[üìö L√©gende]
        A[üü¢ Vert] -->|Entit√© HA| B[ha_entity]
        C[üîµ Bleu] -->|Type Eedomus| D[usage_id/PRODUCT_TYPE_ID]
        E[üü° Jaune] -->|Relation| F[Parent-Enfant]
        G[üü£ Violet] -->|Action| H[Contr√¥le/Mapping]
    end

    subgraph MappingTable[üìã Tableau de Mapping Complet]
        %% Lumi√®re
        EedomusLight[Eedomus: Lumi√®re] -->|üü£| HALight[HA: Light]
        EedomusLight -->|üîµ usage_id=1| Light1
        EedomusLight -->|üîµ PRODUCT_TYPE_ID=2304| LightRGBW
        EedomusLight -->|üîµ PRODUCT_TYPE_ID=2306| LightRGBW2
        
        %% S√©lecteurs
        EedomusSelect[Eedomus: S√©lecteur] -->|üü£| HASelect[HA: Select]
        EedomusSelect -->|üîµ usage_id=14| SelectGroup
        EedomusSelect -->|üîµ usage_id=42| SelectOpening
        EedomusSelect -->|üîµ usage_id=43| SelectAutomation
        EedomusSelect -->|üîµ usage_id=82| SelectColor :::new
        EedomusSelect -->|üîµ PRODUCT_TYPE_ID=999| SelectVirtual
        
        %% Climat
        EedomusClimate[Eedomus: Climat] -->|üü£| HAClimate[HA: Climate]
        EedomusClimate -->|üîµ usage_id=15| ClimateSetpoint
        EedomusClimate -->|üîµ usage_id=19| ClimateFilPilote
        EedomusClimate -->|üîµ usage_id=20| ClimateFilPilote
        EedomusClimate -->|üîµ PRODUCT_TYPE_ID=4| ClimateThermostat
        
        %% Capteurs
        EedomusSensor[Eedomus: Capteur] -->|üü£| HASensor[HA: Sensor]
        EedomusSensor -->|üîµ usage_id=7| SensorTemp
        EedomusSensor -->|üîµ usage_id=22| SensorHumidity
        EedomusSensor -->|üîµ usage_id=24| SensorLuminosity
        EedomusSensor -->|üîµ usage_id=26| SensorEnergy :::new
        
        %% Capteurs Binaires
        EedomusBinary[Eedomus: Binary] -->|üü£| HABinary[HA: Binary Sensor]
        EedomusBinary -->|üîµ usage_id=36| BinaryFlood
        EedomusBinary -->|üîµ usage_id=37| BinaryMotion :::fixed
        EedomusBinary -->|üîµ usage_id=48| BinaryMotion2
        
        %% Interrupteurs
        EedomusSwitch[Eedomus: Interrupteur] -->|üü£| HASwitch[HA: Switch]
        EedomusSwitch -->|üîµ usage_id=0| SwitchGeneric
        EedomusSwitch -->|üîµ usage_id=1| SwitchLight
        EedomusSwitch -->|üîµ usage_id=2| SwitchConsumption :::auto
        
        %% Volets
        EedomusCover[Eedomus: Volet] -->|üü£| HACover[HA: Cover]
        EedomusCover -->|üîµ usage_id=48| CoverShutter
        EedomusCover -->|üîµ PRODUCT_TYPE_ID=770| CoverFibaro
        
        %% Batterie (Nouveau)
        EedomusBattery[Eedomus: Battery] -->|üü£| HABattery[HA: Sensor (battery)]
        EedomusBattery -->|üü° battery field| BatterySensor :::new
    end

    %% Relations Parent-Enfant
    subgraph Relationships[üîó Relations Parent-Enfant]
        RGBWParent[RGBW Light
1077644] -->|üü° parent| RGBWChild1[Rouge
1077645]
        RGBWParent -->|üü° parent| RGBWChild2[Vert
1077646]
        RGBWParent -->|üü° parent| RGBWChild3[Bleu
1077647]
        RGBWParent -->|üü° parent| RGBWChild4[Blanc
1077648]
        RGBWParent -->|üü° parent| RGBWConsumption[Consommation
1077649]
        RGBWParent -->|üü° parent| RGBWColorPreset[Couleur Pr√©d√©finie
1077650]
        
        Thermostat[Consigne
1252441] -->|üü° associated| TempSensor[Temp√©rature
1235856]
        
        MotionSensor[Mouvement
1090995] -->|üü° has| MotionLuminosity[Luminosit√©
1090997]
        MotionSensor -->|üü° has| MotionTemperature[Temp√©rature
1090996]
        MotionSensor -->|üü° has| MotionBattery[Battery
1090995-Battery]
    end

    %% L√©gende des nouveaut√©s
    classDef new fill:#9f9,stroke:#333
    classDef fixed fill:#ff9,stroke:#333
    classDef auto fill:#99f,stroke:#333

    SelectColor:::new
    SensorEnergy:::new
    BinaryMotion:::fixed
    SwitchConsumption:::auto
    BatterySensor:::new
    MotionBattery:::new

    style Legend fill:#f9f,stroke:#333
    style MappingTable fill:#fff,stroke:#333
    style Relationships fill:#fff,stroke:#333
```

### Diagramme Global de Mapping des Entit√©s

```mermaid
flowchart TD
    subgraph Eedomus[Eedomus Box]
        A[P√©riph√©riques Eedomus] -->|API| B[Classes Z-Wave]
        A -->|API| C[Usage IDs]
        A -->|API| D[PRODUCT_TYPE_ID]
        A -->|API| E[Valeurs & √âtats]
    end
    
    subgraph HA[Home Assistant]
        B --> F[Mapping System]
        C --> F
        D --> F
        E --> F
        
        F -->|ha_entity| G[Light Entities]
        F -->|ha_entity| H[Switch Entities]
        F -->|ha_entity| I[Cover Entities]
        F -->|ha_entity| J[Sensor Entities]
        F -->|ha_entity| K[Binary Sensor Entities]
        F -->|ha_entity| L[Select Entities]
        F -->|ha_entity| M[Climate Entities]
        F -->|ha_entity| N[Battery Sensors]
        
        G --> O[RGBW Lights]
        G --> P[Dimmable Lights]
        G --> Q[On/Off Lights]
        
        L --> R[Color Presets]
        L --> S[Shutter Groups]
        L --> T[Automations]
        L --> U[Virtual Devices]
        
        M --> V[Temperature Setpoints]
        M --> W[Fil Pilote Heating]
        M --> X[Thermostats]
        
        N --> Y[Battery Levels]
        N --> Z[Battery Status]
    end
    
    style Eedomus fill:#f9f,stroke:#333
    style HA fill:#bbf,stroke:#333
    style F fill:#9f9,stroke:#333
```

### Architecture D√©taill√©e des Relations Parent-Enfant

```mermaid
classDiagram
    class EedomusDevice {
        +String periph_id
        +String parent_periph_id
        +String name
        +String usage_id
        +String usage_name
        +String value_type
        +String last_value
        +String battery
        +List~Value~ values
    }
    
    class RGBWLight {
        +String periph_id
        +List~Child~ children
        +control_rgbw()
    }
    
    class RGBWChild {
        +String periph_id
        +String parent_periph_id
        +String color_channel
        +set_intensity()
    }
    
    class ClimateDevice {
        +String periph_id
        +String usage_id
        +List~Child~ temperature_sensors
        +set_temperature()
    }
    
    class TemperatureSensor {
        +String periph_id
        +String parent_periph_id
        +String usage_id
        +Float current_temperature
    }
    
    class BatterySensor {
        +String periph_id
        +String device_name
        +Int battery_level
        +String battery_status
    }
    
    EedomusDevice <|-- RGBWLight
    EedomusDevice <|-- RGBWChild
    EedomusDevice <|-- ClimateDevice
    EedomusDevice <|-- TemperatureSensor
    EedomusDevice <|-- BatterySensor
    
    RGBWLight "1" *-- "4" RGBWChild : contains >
    ClimateDevice "1" *-- "1" TemperatureSensor : associated >
    EedomusDevice "1" -- "1" BatterySensor : monitored by >
```

### Exemple Concret : Device RGBW avec Couleurs Pr√©d√©finies

```mermaid
flowchart LR
    subgraph RGBWDevice[RGBW Light Device - Led Meuble Salle de bain]
        direction TB
        Parent[Parent: 1077644
usage_id=1
ha_entity=light
ha_subtype=rgbw] -->|contains| R[Rouge: 1077645
usage_id=1] 
        Parent -->|contains| G[Vert: 1077646
usage_id=1] 
        Parent -->|contains| B[Bleu: 1077647
usage_id=1] 
        Parent -->|contains| W[Blanc: 1077648
usage_id=1] 
        Parent -->|contains| C[Consommation: 1077649
usage_id=26
ha_entity=sensor
ha_subtype=energy] 
        Parent -->|contains| P[Couleur Pr√©d√©finie: 1077650
usage_id=82
ha_entity=select
ha_subtype=color_preset] 
    end
    
    style Parent fill:#9f9,stroke:#333
    style R fill:#f99,stroke:#333
    style G fill:#9f9,stroke:#333
    style B fill:#99f,stroke:#333
    style W fill:#fff,stroke:#333
    style C fill:#ff9,stroke:#333
    style P fill:#f9f,stroke:#333
```

### Exemple Concret : Thermostat avec Capteur Associ√©

```mermaid
flowchart TD
    subgraph ThermostatSystem[Thermostat System - Consigne Salon]
        direction TB
        Setpoint[Consigne: 1252441
usage_id=15
ha_entity=climate
ha_subtype=temperature_setpoint] 
        Setpoint -->|associated with| Sensor[Temp√©rature: 1235856
usage_id=7
ha_entity=sensor
ha_subtype=temperature] 
        Setpoint -->|controls| Heating[Chauffage: 1235855
usage_id=38
ha_entity=climate
ha_subtype=fil_pilote] 
    end
    
    style Setpoint fill:#9f9,stroke:#333
    style Sensor fill:#99f,stroke:#333
    style Heating fill:#f99,stroke:#333
```

### Flux de Donn√©es Complet

```mermaid
flowchart LR
    subgraph Eedomus[Eedomus Box]
        API[API Endpoint] -->|JSON| Devices[Devices Database]
        Devices -->|Update| States[Current States]
        States -->|Webhook| HA
    end
    
    subgraph HA[Home Assistant]
        Webhook[Webhook Receiver] --> Coordinator[Data Coordinator]
        Coordinator -->|Refresh| API
        Coordinator -->|Update| Entities[HA Entities]
        
        Entities -->|Light| LightPlatform
        Entities -->|Switch| SwitchPlatform
        Entities -->|Climate| ClimatePlatform
        Entities -->|Sensor| SensorPlatform
        Entities -->|Binary Sensor| BinarySensorPlatform
        Entities -->|Select| SelectPlatform
        Entities -->|Cover| CoverPlatform
        Entities -->|Battery| BatterySensors
        
        LightPlatform -->|Control| Eedomus
        SwitchPlatform -->|Control| Eedomus
        ClimatePlatform -->|Control| Eedomus
        SelectPlatform -->|Control| Eedomus
        CoverPlatform -->|Control| Eedomus
    end
    
    style Eedomus fill:#f96,stroke:#333
    style HA fill:#9f9,stroke:#333
    style Coordinator fill:#bbf,stroke:#333
```

### L√©gende des Couleurs et Ic√¥nes

```mermaid
graph LR
    A[üü¢ Vert - Entit√©s Principales] -->|Exemple| B[Light, Climate, Coordinator]
    C[üî¥ Rouge - Action/Contr√¥le] -->|Exemple| D[Set Value, Webhook, API]
    E[üü° Jaune - Donn√©es] -->|Exemple| F[States, Values, Battery]
    G[üîµ Bleu - Plateformes] -->|Exemple| H[Sensor, Binary Sensor, Select]
    I[üü£ Violet - Syst√®mes] -->|Exemple| J[Eedomus, Home Assistant]
```

## üîß Configuration des Nouvelles Fonctionnalit√©s

### Activation des Capteurs de Batterie
Les capteurs de batterie sont activ√©s automatiquement. Aucune configuration suppl√©mentaire n'est n√©cessaire.

### Utilisation des Consignes de Temp√©rature
