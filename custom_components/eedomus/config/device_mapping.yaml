# Eedomus Device Mapping Configuration
# Version: 1.0
# 
# This file defines how eedomus devices are mapped to Home Assistant entities.
# Users can customize this mapping through the options flow interface.
#
# Priority order:
# 1. User custom mappings (custom_mapping.yaml)
# 2. Advanced rules (RGBW detection, parent-child relationships)
# 3. Usage ID mappings
# 4. Name pattern matching
# 5. Default mapping

version: 1.0

# Advanced mapping rules for complex device detection
advanced_rules:
  - name: "RGBW Lamp Detection"
    priority: 1
    conditions:
      - usage_id: "1"
      - min_children: 4
      - child_usage_id: "1"
    mapping:
      ha_entity: "light"
      ha_subtype: "rgbw"
      justification: "RGBW lamp with 4+ children (Red, Green, Blue, White)"
      device_class: null
      icon: "mdi:lightbulb"
      is_dynamic: true
    child_mapping:
      "1":
        ha_entity: "light"
        ha_subtype: "dimmable"
        is_dynamic: true

  - name: "Smoke Detector"
    priority: 2
    conditions:
      - usage_id: "27"
    mapping:
      ha_entity: "binary_sensor"
      ha_subtype: "smoke"
      justification: "Smoke detector device"
      device_class: "fire"
      icon: "mdi:fire"
      is_dynamic: true

  - name: "Motion Sensor"
    priority: 2
    conditions:
      - usage_id: "37"
    mapping:
      ha_entity: "binary_sensor"
      ha_subtype: "motion"
      justification: "Motion sensor device"
      device_class: "motion"
      icon: "mdi:walk"
      is_dynamic: true

# Usage ID mappings
usage_id_mappings:
  "0":
    ha_entity: "switch"
    ha_subtype: ""
    justification: "Unknown device type - default to switch"
    device_class: null
    icon: "mdi:toggle-switch"
    is_dynamic: true
  
  "1":
    ha_entity: "light"
    ha_subtype: "dimmable"
    justification: "Dimmable light device"
    device_class: null
    icon: "mdi:lightbulb"
    is_dynamic: true
    
  "2":
    ha_entity: "switch"
    ha_subtype: "consumption"
    justification: "Switch with consumption monitoring"
    device_class: "outlet"
    icon: "mdi:power-socket-eu"
    is_dynamic: true

# Name pattern mappings (regex patterns)
name_patterns:
  - pattern: ".*consommation.*"
    ha_entity: "sensor"
    ha_subtype: "energy"
    device_class: "energy"
    icon: "mdi:lightning-bolt"
    
  - pattern: ".*temp√©rature.*"
    ha_entity: "sensor"
    ha_subtype: "temperature"
    device_class: "temperature"
    icon: "mdi:thermometer"

# Default mapping (fallback)
default_mapping:
  ha_entity: "sensor"
  ha_subtype: "unknown"
  device_class: null
  icon: "mdi:help-circle"
  justification: "Default fallback mapping for unknown devices"
  is_dynamic: false

# Entity type dynamic properties (default values)
# These define which entity types are dynamic by default
# Dynamic devices are those whose state can change unpredictably due to user actions
# They are included in opportunistic refresh mechanisms for real-time updates
# Can be overridden in specific mappings
dynamic_entity_properties:
  light: true      # Lights can be toggled manually - require frequent updates
  switch: true     # Switches can be toggled manually - require frequent updates
  binary_sensor: true  # Motion detectors, door sensors - state changes unpredictably
  sensor: false    # Temperature, humidity - change slowly and predictably
  climate: false   # Thermostat settings - change infrequently
  cover: true      # Shutters/blinds can be operated manually - require frequent updates
  select: false    # Selection menus - change infrequently
  scene: false     # Scene activations - change infrequently

# Specific device dynamic overrides
# Allow users to specify dynamic behavior for individual devices by periph_id
# Format: periph_id: is_dynamic (true/false)
specific_device_dynamic_overrides:
  # Example:
  # "123456": true
  # "789012": false